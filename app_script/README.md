# SubCheck Bot (Google Apps Script Version)

## Описание

Это упрощенная версия Telegram-бота для проверки подписки, полностью адаптированная для работы в среде Google Apps Script. Бот использует Google Таблицу в качестве базы данных и предназначен для управления одним чатом одним администратором, что значительно упрощает настройку и поддержку.

## Основные возможности

*   **Проверка подписки:** Автоматически проверяет, подписан ли новый участник группы на указанный канал.
*   **CAPTCHA:** Защищает чат от ботов с помощью простой математической задачи, которую новый участник должен решить.
*   **Прогрессивные ограничения:** Применяет к нарушителям (не подписавшимся на канал) серию наказаний: от удаления сообщения до временного ограничения на отправку сообщений.
*   **Белый список:** Позволяет добавлять пользователей в "белый список", чтобы на них не распространялись проверки.
*   **Гибкая настройка:** Все параметры (ID чата, ID канала, тексты сообщений, длительность ограничений) настраиваются прямо в Google Таблице.

## Архитектура

Проект построен на нескольких ключевых принципах для обеспечения надежности и производительности в рамках Google Apps Script:

1.  **Google Sheets как БД:** Одна Google Таблица с несколькими листами используется для хранения конфигурации, состояний пользователей и текстов сообщений.
2.  **Модульная структура:** Код разделен на несколько `.gs` файлов, каждый из которых отвечает за свою часть логики (работа с API Telegram, управление таблицей, основная логика и т.д.).
3.  **`LockService` для атомарности:** Для предотвращения "состояний гонки" при одновременной обработке нескольких событий используется сервис блокировок, гарантирующий, что критические операции (как изменение данных пользователя) выполняются последовательно.
4.  **`CacheService` для кеширования:** Настройки и часто запрашиваемые данные кешируются в памяти для максимального ускорения ответа бота и снижения нагрузки на Google Sheets API.
5.  **Надежные обработчики триггеров:** Используются как триггер `doPost(e)` (вебхук от Telegram), так и временные триггеры (`ScriptApp.newTrigger`) для отложенных задач, таких как снятие ограничений или проверка таймаута CAPTCHA.

## Установка и запуск

1.  **Создайте копию Google Таблицы** на основе предоставленного шаблона.
2.  **Создайте проект Google Apps Script** и скопируйте в него все файлы из этой папки.
3.  **Настройте свойства скрипта:** В редакторе Apps Script (`Файл > Свойства проекта > Свойства скрипта`) укажите ваш `BOT_TOKEN` и `SPREADSHEET_ID` (ID вашей таблицы).
4.  **Разверните веб-приложение:** Опубликуйте проект как веб-приложение с доступом для всех (`Развертывание > Новое развертывание`).
5.  **Установите вебхук:** Скопируйте URL развернутого приложения и однократно запустите функцию `setWebhook()` из редактора, чтобы зарегистрировать его в Telegram.
