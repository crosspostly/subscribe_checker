# Telegram Subscription Bot for Google Apps Script

Это Google Apps Script проект для создания Telegram-бота, который контролирует подписку пользователей на обязательный канал и защищает чат от спам-ботов с помощью CAPTCHA.

## Основные возможности

*   **Проверка подписки:** Автоматически проверяет, должен ли участник группы быть подписан на указанный канал.
*   **CAPTCHA:** Защищает чат от ботов, требуя от нового участника нажать на кнопку "Я не робот".
*   **Прогрессивные ограничения:** Применяет к нарушителям (не подписавшимся на канал) серию наказаний: от удаления сообщения до временного ограничения на отправку сообщений с нарастающей длительностью.
*   **Гибкая настройка:** Все параметры (ID канала, длительность ограничений, тексты сообщений) настраиваются прямо в Google Таблице.
*   **Надежность:** Архитектура специально адаптирована под ограничения Google Apps Script, используя `LockService` для безопасной работы с данными и `CacheService` для производительности.
*   **Автоматическая очистка:** Служебные сообщения (предупреждения, CAPTCHA) автоматически удаляются из чата с помощью "сборщика мусора", который работает на одном временном триггере, не превышая квоты Google.

## Установка и настройка

1.  **Создайте Google Таблицу:** Создайте новую Google Таблицу. Она будет использоваться для настроек, логов и хранения данных о пользователях.
2.  **Создайте проект Apps Script:** В Google Таблице откройте `Расширения` > `Apps Script`.
3.  **Вставьте код:** Скопируйте все содержимое из файла `Code.gs` и вставьте его в редактор Apps Script, заменив стандартный код.
4.  **Укажите токен бота:** В самом верху файла `Code.gs` найдите и заполните переменную `BOT_TOKEN`.
5.  **Первичная настройка:**
    *   В редакторе Apps Script выберите функцию `initialSetup` из выпадающего списка.
    *   Нажмите кнопку "▶️ Выполнить".
    *   Предоставьте скрипту все запрашиваемые разрешения.
    *   **Дождитесь выполнения.** Эта функция создаст в вашей таблице все необходимые листы (`Config`, `Texts`, `Users`, `Logs`), установит вебхук для Telegram и создаст триггер для "сборщика мусора".
6.  **Заполните `Config`:**
    *   Вернитесь в вашу Google Таблицу.
    *   На листе `Config` найдите ключ `target_channel_id` и впишите в соседнюю ячейку ID вашего обязательного канала (например, `-100123456789`).
7.  **Развертывание:**
    *   В редакторе Apps Script нажмите `Развертывание` > `Новое развертывание`.
    *   Тип развертывания: **Веб-приложение**.
    *   В поле "Кто имеет доступ": **Все**.
    *   Нажмите `Развернуть`.

После выполнения этих шагов ваш бот полностью готов к работе.
