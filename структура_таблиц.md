# Структура таблиц базы данных

Здесь описана структура таблиц, используемых ботом в `bot_data.db`.

## Таблица `users`

Хранит общую информацию о пользователях бота.

| Поле                  | Тип       | Описание                                        | PK | FK         | Ограничения        |
|-----------------------|-----------|-------------------------------------------------|----|------------|--------------------|
| `user_id`             | INTEGER   | Уникальный идентификатор пользователя Telegram  | ✅ |            | PRIMARY KEY        |
| `username`            | TEXT      | Имя пользователя (@username)                    |    |            |                    |
| `first_name`          | TEXT      | Имя пользователя                                |    |            |                    |
| `last_name`           | TEXT      | Фамилия пользователя                            |    |            |                    |
| `language_code`       | TEXT      | Языковой код пользователя (из Telegram)         |    |            |                    |
| `is_premium`          | INTEGER   | Является ли пользователь Premium (0 или 1)       |    |            | DEFAULT 0          |
| `first_seen_timestamp`| INTEGER   | Unix timestamp первого взаимодействия с ботом   |    |            | NOT NULL           |
| `last_seen_timestamp` | INTEGER   | Unix timestamp последнего взаимодействия с ботом  |    |            |                    |
| `referrer_id`         | INTEGER   | ID пользователя, который пригласил этого       |    | `users(user_id)` | ON DELETE SET NULL |

## Таблица `chats`

Хранит информацию о групповых чатах, где установлен бот, и их настройках.

| Поле                        | Тип     | Описание                                            | PK | FK         | Ограничения        |
|-----------------------------|---------|-----------------------------------------------------|----|------------|--------------------|
| `chat_id`                   | INTEGER | Уникальный идентификатор чата Telegram              | ✅ |            | PRIMARY KEY        |
| `chat_title`                | TEXT    | Название чата                                       |    |            |                    |
| `captcha_enabled`           | INTEGER | Включена ли проверка капчей (1 - да, 0 - нет)       |    |            | DEFAULT 1          |
| `subscription_check_enabled`| INTEGER | Включена ли проверка подписки (1 - да, 0 - нет)     |    |            | DEFAULT 1          |
| `added_timestamp`           | INTEGER | Unix timestamp добавления бота или первой настройки |    |            |                    |
| `configured_by_user_id`   | INTEGER | ID пользователя, который последний раз настроил чат |    | `users(user_id)` | ON DELETE SET NULL |

## Таблица `chat_channel_links`

Связывает чаты с каналами, подписку на которые нужно проверять в этих чатах (связь "многие-ко-многим").

| Поле                  | Тип       | Описание                                        | PK | FK         | Ограничения                    |
|-----------------------|-----------|-------------------------------------------------|----|------------|--------------------------------|
| `link_id`             | INTEGER   | Уникальный идентификатор связи                  | ✅ |            | PRIMARY KEY AUTOINCREMENT      |
| `group_chat_id`       | INTEGER   | ID группового чата                              |    | `chats(chat_id)` | NOT NULL, ON DELETE CASCADE      |
| `channel_id`          | INTEGER   | ID канала для проверки подписки                 |    |            | NOT NULL                       |
| `added_by_user_id`    | INTEGER   | ID пользователя, который добавил эту связь      |    | `users(user_id)` | ON DELETE SET NULL             |
| `added_timestamp`     | INTEGER   | Unix timestamp добавления связи                 |    |            | NOT NULL                       |
|                       |           |                                                 |    |            | UNIQUE (`group_chat_id`, `channel_id`) |

## Таблица `users_status_in_chats`

Хранит статус конкретного пользователя в конкретном чате (прохождение капчи, бан).

| Поле                   | Тип     | Описание                                     | PK | FK                    | Ограничения |
|------------------------|---------|----------------------------------------------|----|-------------------------|-------------|
| `user_id`              | INTEGER | ID пользователя                              | ✅ | `users(user_id)`      | NOT NULL, ON DELETE CASCADE |
| `chat_id`              | INTEGER | ID чата                                      | ✅ | `chats(chat_id)`      | NOT NULL, ON DELETE CASCADE |
| `captcha_passed`       | INTEGER | Пройдена ли капча (1 - да, 0 - нет)          |    |                         | DEFAULT 0   |
| `ban_until`            | INTEGER | Unix timestamp окончания бана (0 - не забанен) |    |                         | DEFAULT 0   |
| `last_update_timestamp`| INTEGER | Unix timestamp последнего обновления записи |    |                         |             | 